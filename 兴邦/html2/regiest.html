<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>title</title>
    <link rel="stylesheet" type="text/css" href="../css/aui.css" />
    <link rel="stylesheet" type="text/css" href="../css/style.css"/>
    <link rel="stylesheet" type="text/css" href="../css/iconfont.css"/>
    <link rel="stylesheet" type="text/css" href="https://unpkg.com/animate.css@3.5.2/animate.min.css" />

</head>
<body class="login-bg2">
  <header class="aui-bar aui-bar-nav" id="aui-header" style="background-color:rgba(0,0,0,0) !important">
      <a class="aui-btn aui-pull-left" tapmode onclick="closeWin()">
          <span class="aui-iconfont aui-icon-left"></span>
      </a>
      <div id="title" class="aui-title">注册</div>
  </header>


  <div class="myui-from">
    <ul class="myui-from-list">
      <li class="myui-from-list-item">
        <div class="myui-code">
          <input id="username" type="tel"  minlength="11" maxlength="11" placeholder="输入手机号码" class="myui-from-list-item-input">
          <!--<button id="btn1" type="button" name="button" style="width:20%;float:left;height: 2.2rem; display:none" class="myui-from-code-button" onclick="getCode()">获取</button>-->
        </div>
      </li>
       <!--<li class="myui-from-list-item">
        <input id="yzcode" type="tel" minlength="6" maxlength="6" placeholder="短信验证码" class="myui-from-list-item-input" style="display:none">
      </li>-->
      <li class="myui-from-list-item">
        <input id="password" type="password" placeholder="设置密码" class="myui-from-list-item-input">
      </li>
	    <li class="myui-from-list-item">
        <input id="password_reg" type="password" placeholder="再输入一次密码" class="myui-from-list-item-input">
      </li>
       <li class="myui-from-list-item" style="display:none">
        <input id="share" type="tel" minlength="6" maxlength="6" placeholder="邀请码(选填)" class="myui-from-list-item-input">
      </li>
      <li class="myui-from-list-item">
        <button id="btn2" type="button" name="button" class="myui-from-list-item-button" onclick="toReg()">立即注册</button>
      </li>
    </ul>
  </div>
  <div class="tishi"><span id="tishi"></span></div>
  <div class="middle" style="padding: 0.6rem;background-color: rgba(95, 96, 91, 0.7) !important;margin: 0 auto;font-size: 0.6rem;border-radius: 0.5rem;color: white;position: absolute;top: 50%;left: 50%;transform: translate(-50%, -50%);">ooooo</div>
  <div class="bg"></div>
	<div class="tanchu">
		<p class="tanchu_title" style="font-size: 1.3rem;color: #000;"></p>
		<p class="tanchu_msg" style="font-size: .9rem;margin-top: .6rem;color: #000;"></p>
		<p style="font-size: .8rem;color: #4FA81F;text-align: right;margin-top: 1.6rem;" onclick="bgHide()">确定</p>
	</div>
</body>
<!--<script type="text/javascript" src="../script/api.js" ></script>-->
<script type="text/javascript" src="../script/jquery-3.2.1.min.js"></script>
<script type="text/javascript">
    var api_url = localStorage.getItem('api_url');
    $(".tishi").hide();
    $(".bg").hide();
    $(".tanchu").hide();
    $(".middle").hide();
    var onoff = true;
    var code_data = '';
    var user = '';
    var pass = '';
	var pass02 = '';
//  apiready = function () {
//    api.parseTapmode();
//    var header = $api.byId('aui-header');
//    $api.fixStatusBar(header);
//    var headerPos = $api.offset(header);
//    var body_h = $api.offset($api.dom('body')).h;
//
//  }

	function tanChu(title,msg) {
    	$(".bg").show();
    	$(".tanchu").show();
    	$(".tanchu_title").html(title);
    	$(".tanchu_msg").html(msg);
    }
    function bgHide() {
    	$(".bg").hide();
    	$(".tanchu").hide();
    }
    function tishi(content,time) {
		$("#tishi").html(content);
		$(".tishi").addClass("animated fadeInUp").show();
		setTimeout(function() {
			$(".tishi").removeClass("animated fadeInUp").hide();
		}, time);
	}
    //注册
    function toReg(){
    	var username = $("#username").val();
      var password = $("#password").val();
      var password_reg = $("#password_reg").val();
      var yzcode = $("#yzcode").val();
      var share = $("#share").val();
      if(username == ''){
//      api.alert({
//          title: '警告！',
//          msg: '请输入登录账号',
//      });
        tanChu('警告！','请输入登录账号');
        return;
      }
      if(password == '' || password_reg == ''){
//      api.alert({
//          title: '警告！',
//          msg: '请输入密码',
//      });
        tanChu('警告！','请输入密码');
        return;
      }

       //if(share == ''){
        // api.alert({
        //     title: '警告！',
        //     msg: '请输入邀请码',
        // });
        // return;
       //}
      if(username.length < 6){
//      api.alert({
//          title: '警告！',
//          msg: '请输入6位以上密码',
//      });
        tanChu('警告！','请输入6位以上密码');
        return;
      }

	  if ($('#password').val() != $('#password_reg').val()) {
                $('#password_reg').focus();
//              api.toast({
//                  msg : '两次密码不一致，请重新输入!'
//              });
                tishi('两次密码不一致，请重新输入!',2000);
                return;
                 }
      //if(yzcode != code_data){
////        api.alert({
////            title: '错误提示',
////            msg: '您输入的验证码不正确',
////        });
//    		tanChu('错误提示','您输入的验证码不正确');
      //  return;
      //}
      //if(localStorage.getItem('reg_name') == username){
      //}else {
//      //api.alert({
//      //    title: '错误提示',
//     //     msg: '手机号输入不一致',
//     // });
//     tanChu('错误提示','手机号输入不一致');
       // return;
     // }
      user = $('#username');
      pass = $('#password');
	  pass02 = $('#password_reg');
//    api.showProgress({
//        title: '注册中...',
//        text: '请稍等...',
//        modal: false
//    });
      $.ajax({
          url: 'https://kankan.51xingbang.com/login/login/create.html',
          type: 'get',
          dataType: 'json',
          data: {
              name: username,
              password:password,
			  share:share
          },
          success: function(ret) {
	          if (ret) {
	              if (ret.code == 0) {
	//              api.hideProgress();
//	                api.alert({
//	                    title: '错误~',
//	                    msg: ret.msg,
//	                });
	                tanChu('错误~',ret.msg);
	              }else {
	
	//              api.hideProgress();
	//              api.alert({
	//                  title: '注册成功！',
	//                  msg: '当前身份：体验会员',
	//              });
	                tanChu('注册成功！','当前身份：体验会员');
	//              api.closeWin({
	//                  name: 'login'
	//              });
	                //openLogin();
	                
	//				返回到会员中心页面,并刷新
	
	                $.ajax({
	                    url: 'https://kankan.51xingbang.com/login/login/veifys.html',
	                    type: 'get',
	                    dataType: 'json',
	                    data: {
	                        username: username,
	                        passwd: password,
	//                          imei:api.deviceId
	                    },
	                    success:function(ret){
		                    if (ret) {
		                      if (ret.code == 0) {
		//                      api.hideProgress();
								tanChu('','账号或密码不正确');
		//                      alert('账号或密码不正确');
		                        return;
		                      }else if (ret.code == 1) {
		                        //alert( JSON.stringify( ret ) );
		                          localStorage.setItem('user_id',ret.msg['id']);
		                          localStorage.setItem('user_name',username);
		                          localStorage.setItem('password',password);
		                          localStorage.setItem('user_time',ret.msg['time']);
		                          localStorage.setItem('user_share',ret.msg['share']);
		                          localStorage.setItem('user_advert',ret.msg['advert']);
		                          localStorage.setItem('user_code',ret.msg['code']);
		                          localStorage.setItem('user_weichat',ret.msg['weichat']);
		                          localStorage.setItem('url',ret.msg['url']);
		                          localStorage.setItem('url1',ret.msg['url1']);
		                          localStorage.setItem('url2',ret.msg['url2']);
		                          localStorage.setItem('url3',ret.msg['url3']);
		                          localStorage.setItem('url4',ret.msg['url4']);
		                          setTimeout(function() {
										window.location.href = "./mine.html";
									},2000);
		//                        api.sendEvent({
		//                          name: 'newLoingdata',
		//                          extra: {
		//                          }
		//                        });
		
		
		//                        api.hideProgress();
		                          //alert('登录成功');
		
		//                        api.closeWin();
		                      }
		                    } else {
	//	                      api.hideProgress();
	//	                      alert('网络错误！');
		                      tanChu('提示','网络错误！');
		                      //alert( JSON.stringify( err ) );
		                      return;
		                    }
		               }
	                });
	
	
	//              api.closeWin();
	              }
	          } else {
	//          api.hideProgress();
	//          api.alert({
	//              title: '糟糕~',
	//              msg: '网络错误！',
	//          });
	            tanChu('糟糕~','网络错误！');
	          }
	        }
      });
    }

    //页面传参 (返回到登录页)
//  function openLogin(){
//      var delay = 0;
//      if(api.systemType != 'ios'){
//          delay = 300;
//      }
//
//
//      api.openWin({
//          name: 'login',
//          url: './login.html',
//          pageParam:{user:user,pass:pass},
//      });
//  }

    //获取验证码
    function getCode(){
      var yzcode = $('#yzcode');
      var btn1 = $('#btn1');
      var username = $('#username').val();
      localStorage.setItem('reg_name',username);
      if (!onoff) {
        return;
      }
      onoff = false;

      if(username == ''){
//      api.alert({
//          title: '警告！',
//          msg: '请输入手机号码',
//      });
        tanChu('警告！','请输入手机号码');
        onoff = true;
        return;
      }
      if(username.length != 11){
//      api.alert({
//          title: '警告！',
//          msg: '请输入11位手机号码',
//      });
        tanChu('警告！','请输入11位手机号码');
        onoff = true;
        return;
      }
      code_data = RndNum(6);
      var content = escape('#code#='+code_data);
      //alert(code_data);
      $.ajax({
          url: 'http://v.juhe.cn/sms/send?mobile='+username+'&tpl_id=898989tpl_value='+content+'&key=888888888888888888',
          type: 'get',
          dataType: 'json',
          success:function(ret, err){
	        // if (ret) {
	        //   alert( JSON.stringify( ret ) );
	        // }else {
	        //   alert( JSON.stringify( err ) );
	        // }
	
	//            api.toast({
	//                msg: '发送成功',
	//                duration: 1000,
	//                location: 'middle'
	//            });
	              $(".middle").html("发送成功").show();
					setTimeout(function() {
						$(".middle").hide();
					}, 1000);
	              var nuw = 60;
	              var timer = setInterval(function(){
	                nuw --;
	
	                if (nuw < 1) {
	                  btn1.html('获取');
	                  clearInterval(timer);
	                  onoff = true;
	                }else {
	                  btn1.html(nuw+'s');
	                }
	
	
	              },1000)
	        }
      });


    }

    //生成验证码
    function RndNum(n){
      var rnd="";
      for(var i=0;i<n;i++)
          rnd+=Math.floor(Math.random()*10);
      return rnd;
    }


    function closeWin(){
        window.history.back();
    }

//  function openWin(name){
//        var delay = 0;
//        if(api.systemType != 'ios'){
//            delay = 300;
//        }
//        api.openWin({
//            name: ''+name+'',
//            url: ''+name+'.html',
//            bounces:false,
//            delay: delay,
//            slidBackEnabled:true,
//            vScrollBarEnabled:false
//        });
//    }
</script>
</html>
